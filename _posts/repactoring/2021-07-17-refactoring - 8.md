---
layout: post
title: 리팩터링 리뷰 - 7
subtitle: "spring, security"
categories: spring
tags: security
comments: true
---
> repactoring

----
API 리팩터링
====

모듈과 함수는 소프트웨어를 구성하는 빌딩 블록이며, api는 이 블록들을 끼워 맞추는 연결부이다.


## 1. 질의 함수와 변경 함수 분리하기

  - 문장슬라이스 하기에서 나온 부분이긴 하다. 
  - 질의 함수(get)은 질의만 해야한다. 질의함수 내에서는 어떤 값의 변경이 없어야한다. 
 
  - 외부에서 관찰할 수 있는 겉보기 부수효과가 전혀 업이 값을 반환해주는 함수를 추구해야한다.
  - 이를 실행하기 위해서는 질의함수(읽기함수)는 모두 부수효과가 없어야한다는 규칙을 따르는것이다. 
  - 이를 CQS(command query separate) 라고 부르고 절대적으로 따르는 사람도 많다. 
  - 값을 반환하면서 부수효과도 있는 함수를 발견하면 상태를 변경하는 부분과 질의하는 부분을 분리하여 시도해야한다. 

  1. 함수를 복제하고 질의 목적에 맞는 이름 짓기
  2. 새 질의 함수에서 부수효과를 낳는 부분을 제거하기
  3. 이제 원래 함수를 호출하는 곳을 모두 찾아서 새로운 질의 함수를 호출하고록 바꾸고, 이어서 원래의 변경 함수를 호출하는 코드를 바로 아래에 삽입한다.

## 2. 함수 매개변수화 하기

  - 두함수의 로직이 아주 비슷하고 단지 리터럴 값만 다르다면, 그 다른 값만 매개변수로 받아 처리 하는 함수 하나로 합쳐서 중복을 없앨수있다. 
   

  1. 비슷한 함수중 하나를 선택한다.
     - 비슷한 함수들을 매개변수화 하여 통합할때는 먼저 대상 함수중 하나를 골라 매개변수를 추가한다.
  2. 함수 선언 바꾸기를 리터럴들을 매개변수로 추가한다.
  3. 이 함수를 호출하는 곳 모두에 적절한 리터럴 값을 추가한다.
  4. 테스트
  5. 매개변수로 받은 값을 사용하도록 함수 본문을 수정한다.
  6. 비슷한 다른함수를 호출하는 코드를 찾아 매개변수화된 함수를 호출하도록 하나씩 수정한다. 


## 3. 플래그 인수 제거하기

  - 플래그 인수란 호출되는 함수가 실행할 로직을 호출하는 쪽에서 선택하기 위해 전달하는 인수이다.
   
  - 결국은 가독성의 문제이다. 

  - 저자는 플래그 인수를 2개이상 사용하는것과 플래그인수 그자체를 좋은 시선으로 보고 있지않다 
    - 왜? 함수사용시에 있어 고려해야하는 부분으로 사용자가 고려해야하는 부분으로 받아들이기 때문이다. 그렇기 때문에 명확적인 함수를 제공하는게 더 좋다고 생각한다. 
## 4. 객체 통째로넘기기

  - 매개변수(파라미터) 여러개를 넘긴다면 함수이해하기가 매우 어려워진다. 
  - 또한 중복된 코드가 발생할수있다.
  - 이를 방지하고자 객체를 통재로 넘기는게 좋다. 
  
  - 함수가 레코드 자체에 의존하기를 원치 않을 때는 하지 말자 
    - 레코드와 함수가 서로 다른 모듈이라면 특히 하지말자 

  - 한 함수에 객체에서 가져온 값 몇 개만으로 무언가를 한다면? 
    - 그 객체로 옮겨줘야 한다. 

  - 객체 전반에서 똑같은 값 몇개만 사용하는 함수가 많다면? 
    - 그 부분 클래스 추출 해야한다.
  
  1. new접두사를 붙인 빈함수를 만든다.
  2. 새함수의 본문에서 원래 함수를 호출하도록 하며, 새 매개변수와 원래 함수의 매개변수를 매핑한다.
  3. 정적검사
  4. 모든 호출자가 새함수를 사용하게 수정한다. 
  5. 호출자를 모두 수정했다면 원래 함수를 인라인한다.
  6. 새함수의 이름을 적절히 수정하고 모든 호출자에 반영한다.

## 5. 매개변수를 질의 함수로 바꾸기

  - 매개변수를 제거하면 값을 결정하는 책임 주체가 달라진다. 
  - 매개변수가 있다면 결정 주체가 호출자가 된다. 
  - 매개변수가 없다면 피호출함수가 된다. 
  - 호출하는 쪽을 간소하게 즉 책임소재를 피호출함수로 올기는 것이 좋다. 물론 피호출 함수가 그역할을 수행하기에 적합할때만 하는게 좋다. 

  - 매개변수를 질의 함수로 바꾸지 말아야 할 상황도 있다. 
    - 매개변수를 제거하였을때, 피호출 함수에 원치 않는 의존성이 생길 때다. 
    - 즉. 해당함수가 알지 못했으면 하는 프로그램요소에 접근해야 하는 상황을 만들 때다.
    - 새로운 의존성이 생기거나 제거하고 싶은 기존 의존성을 강화하는 경우라 할 수 있다. 


## 6. 질의함수를 매개변수로 바꾸기

  - 전역변수를 참조하거나, 제거하길 원하는 원소를 참조하는 경우
  - 해당 참조를 매개변수로 바꿔 해결한다. 

## 7. 세터 제거하기

  - 세터 제거하기는 두가지 상황으로 나뉜다. 
  - 첫째 : 무조건 접근자 메서드를 통해서만 필드를 다루려 할때다. 생성자 안에서도 세터로 값변경하는것이다.
  - 둘째 : 클라이언트에서 생선 스크립트를 사용해 객체를 생성할 때다.
    - 생성스크립트 : 생성자를 호출한 후 일련의 세터를 호출하여 객체를 완성하는 형태의 코드를 말한다. 

## 8. 생성자를 팩터리 함수로 바꾸기

  - 팩터리 함수를 사용하면 서브클래스의 인스턴스나 프락시도 반환가능하다.
    - 자바는 생성자의 정의한 클래스의 인스턴스를 반환해야한다.
  - 팩터리 함수에는 이러한 제약이 없다.

  1. 팩터리 함수를 만든다. (생성자에 위임하는 방식으로 구현한다.)
  2. 생성자를 호출하는곳을 수정한다.

## 9. 함수를 명령으로 바꾸기

  - 함수를 그함수만을 위한 객체 안으로 캡슐화하면 더 유용해지는 상황이 있다. 
  - 이런객체를 가리켜 '명령객체' 또는 단순히 명령이라 한다. 
  - 명령은 평범한 함수 메커니즘보다 훨씬 유연하게 함수를 제어하고 표현할 수 있다.
  - 객체는 지원하지만 일급함수를 지원하지 않는 프로그래밍 언어를 사용할 때는 명령을 이용해 일급 함수의 기능을 대부분 흉내낼수있다.

  - 명령은 되돌리기 같은 보조 연산을 제공할 수 있으며, 수명주기를 더 정밀하게 제어하는데 필요한 매개변수를 만들어주는 메서드도 제공 할 수있다.

  ```
   class Score{
       constructor(a,b,c){
           this.a = a;
           this.b = b;
           this.c = c;
       }

       execute(){
           this.result = 0;
           ~
            ~ // 수많은 코드들
       }
   }
  ```

  위와같이 명령을 함수내부에 둘수있고 이는 수명주기, 보조연산에서 매우 유용하게 사용된다.    
  예를들면 안드로이드를 생각하면 run등..의 여러가지 실행함수가 존재함을 알수있다. 


## 10. 명령을 함수로 바꾸기

  - 명령 객체는 복잡한 연산을 다룰 수 있는 강력한 메커니즘을 제공한다. 
  - 명령 객체가 단순하면 괜히 복잡하게 기능을 구현하게 된것이다. >> 관점에 따라 이는 악취가 될수있다. 
  - 그러므로 명령이 단순하다면 함수로 바꿔주는게 났다. 


## 11. 수전된 값 반환하기 

  - 데이터가ㅈ수정된다면 그사실을 명확하게 알려주어 함수혹은 변수의 목적을 설명하는것이 좋다. 
  - 함수옮기기 의 준비작업인 셈이다. 


## 12. 오류 코드를 예외로 바꾸기

  - 예외처리가 가능한 프로그래밍에서 예외를 날리면 좋다 .
  - 이는 콜스택 어느곳에서든지 에러를 처리할수있기 때문이다. 
  - 하지만 c언어를 생각해보면 반환형이 int등으로 되어있었고 현재는 포인터를 넘겨서 에러를 확인해야한다. 
  - 이러한 c언어의 방식에서 에러처리는 함수호출전의 라인에서 에러를 컨트롤 할수있게된다. 


  - 그렇다면 예외처리 클래스가 좋은데 예외가 예상이 가면 이를 조건문으로 처리하는것이 좋다. 
  - 알수있는 에러는 미리 방지하는것이다. 



